# Git Guide — hotel-manager

**Repo:** https://github.com/vtsamourzis/hotel-manager
**Branch:** `master`
**Local path (dev):** `D:\Ha-Project\AegeanSea\hotel-manager`
**Server path (CT101):** `/opt/hotel-manager`

---

## What gets pushed (and what doesn't)

### Tracked (pushed to GitHub)

Everything in the project except what's listed in `.gitignore`:

- `app/` — All pages, layouts, API routes
- `components/` — All React components
- `lib/` — Stores, auth, HA connection, utilities
- `public/` — Icons, manifest, service worker
- `packages/` — HA room YAML configs
- `scripts/` — Backup script, seed script
- `styles/` — CSS modules, globals
- `.env.example` — Template with variable names (no secrets)
- `DEPLOY.md` — Deployment guide
- `Dockerfile`, `docker-compose.yml`, `Caddyfile` — For future Docker use
- `ecosystem.config.js` — PM2 config
- `package.json`, `pnpm-lock.yaml`, `tsconfig.json`, `next.config.ts`

### Excluded (never pushed — in .gitignore)

| Path | Why |
|------|-----|
| `.env` | Contains secrets (HA_TOKEN, AUTH_SECRET) |
| `.env.local` | Local dev secrets |
| `node_modules/` | Dependencies — reinstalled with `pnpm install` |
| `.next/` | Build output — rebuilt with `pnpm build` |
| `data/` | SQLite database — unique per machine |
| `next-env.d.ts` | Auto-generated by Next.js |
| `*.tsbuildinfo` | TypeScript cache |

**Rule:** Secrets and generated files stay local. Code and config templates go to GitHub.

---

## Push changes (from dev machine)

After making changes on your Windows machine:

```bash
cd D:\Ha-Project\AegeanSea\hotel-manager

# 1. See what changed
git status

# 2. Stage all changes
git add -A

# 3. Review what you're about to commit
git status

# 4. Commit with a message describing what you changed
git commit -m "short description of what changed"

# 5. Push to GitHub
git push origin master
```

### Example messages

```bash
git commit -m "fix: room card not showing temperature"
git commit -m "feat: add booking calendar view"
git commit -m "style: update overview page layout"
git commit -m "chore: update dependencies"
```

### Push specific files only (instead of everything)

```bash
# Stage only specific files
git add app/rooms/page.tsx components/rooms/RoomCard.tsx

# Then commit and push
git commit -m "fix: room card layout"
git push origin master
```

---

## Pull changes on CT101 (deploy update)

```bash
ssh root@10.10.90.11
cd /opt/hotel-manager

# 1. Pull latest code
git pull

# 2. Install dependencies (only if package.json changed)
pnpm install

# 3. Rebuild
pnpm build

# 4. Restart the app
pm2 restart hotel-manager

# 5. Verify
curl http://localhost:3000/api/health
```

**One-liner for quick updates:**
```bash
cd /opt/hotel-manager && git pull && pnpm build && pm2 restart hotel-manager
```

---

## Common situations

### "I changed files but I'm not sure what"

```bash
git status           # Shows modified/new/deleted files
git diff             # Shows line-by-line changes
git diff --stat      # Shows summary (files + lines changed)
```

### "I want to undo changes to a file before committing"

```bash
git checkout -- path/to/file.tsx
```

### "I committed but haven't pushed — want to undo"

```bash
git reset --soft HEAD~1    # Undo last commit, keep changes staged
```

### "CT101 has local changes that conflict with pull"

This shouldn't happen (CT101 shouldn't have local edits), but if it does:

```bash
# Discard CT101 local changes and match GitHub
git reset --hard origin/master
```

### "I want to see what's on GitHub vs what I have locally"

```bash
git fetch origin
git log master..origin/master --oneline   # Commits on GitHub you don't have
git log origin/master..master --oneline   # Commits you have but GitHub doesn't
```

---

## First-time setup on a new machine

```bash
# Configure git (one-time)
git config --global user.name "Your Name"
git config --global user.email "your@email.com"

# Clone
cd /opt
git clone https://github.com/vtsamourzis/hotel-manager.git
cd hotel-manager

# Set up environment
cp .env.example .env
nano .env
# Fill in your secrets: HA_URL, HA_TOKEN, AUTH_SECRET

# Install and build
pnpm install
pnpm build
```

---

## Quick reference

| Action | Command |
|--------|---------|
| See changes | `git status` |
| Stage all | `git add -A` |
| Stage one file | `git add path/to/file` |
| Commit | `git commit -m "message"` |
| Push | `git push origin master` |
| Pull | `git pull` |
| View log | `git log --oneline -10` |
| Undo unstaged changes | `git checkout -- file` |
| Undo last commit (keep files) | `git reset --soft HEAD~1` |
